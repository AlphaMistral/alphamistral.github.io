<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="null">
    <meta name="keyword" content="null">
    <meta name="theme-color" content="#600090">
    <meta name="msapplication-navbutton-color" content="#600090">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#600090">
    <link rel="shortcut icon" href="https://cdn4.iconfinder.com/data/icons/ionicons/512/icon-person-128.png">
    <link rel="alternate" type="application/atom+xml" title="Weymire" href="/atom.xml">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.css">
    <title>
        
        ç›¸äº¤é«˜äº®(æ‰«ææ•ˆæœ)ï½œWeymire&#39;s Blog
        
    </title>

    <link rel="canonical" href="http://www.weymire.com/2016/11/27/essay3/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/blog-style.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<style>

    header.intro-header {
        background-image: url('../image/tags.jpg')
    }
</style>
<!-- hack iOS CSS :active style -->
<body ontouchstart="" class="animated fadeIn">
<!-- hexo-inject:begin --><!-- hexo-inject:end --><!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top " id="nav-top" data-ispost = "true" data-istags="false
" data-ishome = "false" >
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand animated pulse" href="/">
                <span class="brand-logo">
                    Weymire
                </span>
                's Blog
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <!-- /.navbar-collapse -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
					
                    
                        
							
                        <li>
                            <a href="/Portfolio/">Portfolio</a>
                        </li>
							
						
                    
                        
							
                        <li>
                            <a href="/tags/">Featured Tags</a>
                        </li>
							
						
                    
					
					
                </ul>
            </div>
        </div>
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
//    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>

<!-- Main Content -->

<!--only post-->


<img class="wechat-title-img"
     src="http://ol56no7p4.bkt.clouddn.com/essay3.jpg">


<style>
    
    header.intro-header {
        background-image: url('http://ol56no7p4.bkt.clouddn.com/essay3.jpg?imageView2/1/w/1400/h/400/interlace/1/q/90')
    }

    
</style>

<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center">
                <div class="post-heading">
                    <h1>ç›¸äº¤é«˜äº®(æ‰«ææ•ˆæœ)</h1>
                    
                    <h2 class="subheading">å¤šç”¨äºç§‘å¹»æ¸¸æˆä¸­çš„Intersection Highlightç‰¹æ•ˆ</h2>
                    
                    <span class="meta">
                         ä½œè€… Jingping Yu
                        <span>
                          æ—¥æœŸ 2016-11-27
                         </span>
                    </span>
                    <div class="tags text-center">
                        
                        <a class="tag" href="/tags/#Unity"
                           title="Unity">Unity</a>
                        
                        <a class="tag" href="/tags/#Computer Graphics"
                           title="Computer Graphics">Computer Graphics</a>
                        
                        <a class="tag" href="/tags/#Shader"
                           title="Shader">Shader</a>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="post-title-haojen">
        <span>
            ç›¸äº¤é«˜äº®(æ‰«ææ•ˆæœ)
        </span>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <!-- Post Container -->
            <div class="col-lg-8 col-lg-offset-1 col-sm-9 post-container">
                <script src="/assets/js/DPlayer.min.js"> </script><p>æœ¬æ–‡åŒæ—¶ä¹Ÿå‘è¡¨åœ¨æˆ‘çš„<a href="https://zhuanlan.zhihu.com/p/23971284?refer=MeowShader" target="_blank" rel="external">çŸ¥ä¹ä¸“æ </a>ä¸ŠğŸ˜„. ä¸è¿‡å½“æ—¶å†™ä½œçš„é£æ ¼å®åœ¨ä¸é€‚åˆæŠ€æœ¯æ–‡, å› æ­¤åœ¨ä¸ªäººåšå®¢ä¸­çš„è¿™ç¯‡æ–‡ç« ç»è¿‡äº†ä¸€äº›ä¿®æ”¹.</p>
<blockquote>
<p>ä½œè€…ï¼šéŸ³é€Ÿé”®ç›˜çŒ«</p>
<p>é“¾æ¥ï¼šhttps://zhuanlan.zhihu.com/p/23971284?refer=MeowShader</p>
<p>æ¥æºï¼šçŸ¥ä¹</p>
<p>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
</blockquote>
<h2>ç›¸äº¤é«˜äº®(Intersection Highlight)æ˜¯ä»€ä¹ˆ</h2>
<p>ç›¸äº¤é«˜äº®, æ˜¯ä¸€ç§é™„åŠ åœ¨Meshä¸Šçš„ç€è‰²å™¨ç‰¹æ•ˆ, å…¶åŠŸèƒ½æ˜¯å°†æ‰€æœ‰å…¶ä»–ç©¿è¿‡è¯¥Meshè¡¨é¢çš„æˆªé¢è½®å»“ç»˜åˆ¶å‡ºæ¥, äº§ç”Ÿä¸€ç§ç±»ä¼¼äºæ‰«æä¸€æ ·çš„æ•ˆæœ. å¤šç”¨äº<strong>ç§‘å¹»ç±»æ¸¸æˆ</strong>ä¸­.</p>
<p><img src="/image/essay3/2.jpg" alt=""></p>
<p>åœ¨è¿™é‡Œæˆ‘è¦æ£€è®¨ä¸‹ ... è¿™ç§ç›¸äº¤é«˜äº®çš„ç‰¹æ•ˆå‡ºç°çš„é¢‘æ¬¡çœŸå¿ƒä¸ä½, æˆ‘èƒ½ç¡®åˆ‡æƒ³èµ·æ¥çš„å®é™…åº”ç”¨æ¸¸æˆä¾¿æœ‰<em>æ€æˆ®åœ°å¸¦</em>ç³»åˆ—, <em>è´¨é‡æ•ˆåº”</em>ç³»åˆ—, <em>æ³°å¦é™¨è½</em>ç³»åˆ—å’Œ<em>æ­»äº¡ç©ºé—´</em>ç³»åˆ—. ä¸è¿‡åœ¨youtubeä¸Šæ‰¾äº†å¥½å‡ åœˆä¹Ÿæ²¡æœ‰æ‰¾åˆ°ä¸€ä¸ªåŒ…å«äº†è¿™ä¸ªæ•ˆæœçš„è§†é¢‘ ... æ‰€ä»¥è¯´åªèƒ½è´´ä¸Šè¿™å¼ å›¾å•¦.</p>
<h2>ç›¸äº¤é«˜äº®ç€è‰²å™¨å·¥ä½œåŸç†</h2>
<p>è·å–å½“å‰æ‘„åƒæœºæ¸²æŸ“çš„åœºæ™¯çš„<strong>DepthBuffer</strong>, åœ¨æ¸²æŸ“å½“å‰æ¨¡å‹çš„æ—¶å€™åˆ¤æ–­æ¯ä¸€ä¸ªç»è¿‡åæ ‡å˜æ¢çš„ç‰‡å…ƒçš„ä¸–ç•Œåæ ‡Zæ˜¯å¦å’ŒDepthBufferçš„å¯¹åº”ç‚¹æ·±åº¦è¶³å¤Ÿæ¥è¿‘. å¦‚æœè¶³å¤Ÿæ¥è¿‘, åˆ™å°†å…¶æ¸²æŸ“æˆå¦ä¸€ç§é¢œè‰².</p>
<h2>çŒœä¸€çŒœå®ç°çš„æ–¹æ³•</h2>
<p><img src="/image/essay3/3.png" alt=""></p>
<p>æˆ‘ä»¬è¦å®ç°çš„å°±æ˜¯é‚£ä¸ªæ­£æ–¹ä½“çš„æè´¨. ä»å›¾ä¸­æˆ‘ä»¬æ¸…æ¥šçš„çœ‹åˆ°, æ°´å£¶, ç”µè„‘å’Œé”®ç›˜åœ¨æ­£æ–¹ä½“å¤–é¢çš„éƒ¨åˆ†æ˜¯éå¸¸æ­£å¸¸çš„, åœ¨æ­£æ–¹ä½“å†…éƒ¨çš„éƒ¨åˆ†è’™ä¸Šäº†ä¸€å±‚é»„è‰². <strong>ä½†æ˜¯å’Œæ­£æ–¹ä½“çš„ç›¸äº¤æˆªé¢çš„å¤–è½®å»“è¢«ç»˜åˆ¶æˆäº†è“é¢œè‰²</strong>.</p>
<p>åˆ°æ­¤, æˆ‘ä»¬èƒ½å¤Ÿæ¨æ–­å‡ºæ¥çš„äº‹å®æœ‰:</p>
<ul>
<li>
<p>1	Blend Modeä¸º: Blend SrcAlpha OneMinusSrcAlpha åŸå› å¾ˆç®€å•, å› ä¸ºæˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡æ­£æ–¹ä½“çœ‹åˆ°å…¶åé¢çš„ç‰©ä½“, è¿™è¯´æ˜æ­£æ–¹ä½“æœ¬èº«çš„é¢œè‰²å’ŒåŸæœ¬çš„ColorBufferçš„Alphaå€¼è¢«&quot;å¹³åˆ†ç§‹è‰²&quot;åè¿›è¡Œäº†æ··åˆ. ä¾ç„¶çœ‹ä¸æ‡‚çš„ç«¥é‹è¯·å‚è§<a href="https://docs.unity3d.com/Manual/SL-Blend.html" target="_blank" rel="external">Unityå®˜æ–¹æ–‡æ¡£</a>.</p>
</li>
<li>
<p>2	RenderQueueä¸ºTransparent å¾ˆæ˜æ˜¾, æˆ‘ä»¬å½“ç„¶æ˜¯å¸Œæœ›è¿™ä¸ªæ­£æ–¹ä½“åœ¨Geometryåæ¸²æŸ“å‡ºæ¥, è¿™æ ·æ‰èƒ½é€è¿‡å®ƒçœ‹åˆ°ä¼˜å…ˆæ¸²æŸ“çš„Opaque Materials. å…³äºRender Orderçš„è¯¦ç»†æè¿°å¯ä»¥çœ‹<a href="https://docs.unity3d.com/462/Documentation/Manual/SL-SubshaderTags.html" target="_blank" rel="external">Unityå®˜æ–¹æ–‡æ¡£</a>.</p>
</li>
<li>
<p>3	æ­£å› ä¸ºæˆ‘ä»¬çš„æ­£æ–¹ä½“æ˜¯è¢«åæ¸²æŸ“å‡ºæ¥çš„, æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡å½“å‰çš„ColorBufferæˆ–è€…æ˜¯DepthBufferç­‰èµ„æºæ¥ä»¥æŸç§æ–¹å¼å¤„ç†ç›¸äº¤æˆªé¢.</p>
</li>
<li>
<p>4	ä½†æ˜¯ä¸ç®¡æˆªé¢åˆ°åº•æ˜¯æ€ä¹ˆè¢«å¤„ç†å‡ºæ¥çš„, æˆ‘ä»¬å¿…é¡»å¾—çŸ¥é“å±å¹•ä¸ŠæŸç‚¹çš„ä¸–ç•Œåæ ‡ç›¸å¯¹äºæ­£æ–¹ä½“æŸä¸ªç‰‡å…ƒçš„ä¸–ç•Œåæ ‡çš„ç›¸å¯¹å…³ç³».</p>
</li>
</ul>
<p>å¾ˆæ˜æ˜¾, æˆ‘ä»¬è¦åšçš„å°±æ˜¯ä¼˜é›…åœ°è§£å†³ç¬¬å››ä¸ªé—®é¢˜.</p>
<h2>å¦‚ä½•ä¼˜é›…åœ°æ±‚åæ ‡</h2>
<p>å¯ä»¥é€šè¿‡DepthBuffer, æ‘„åƒæœºNear Clip Plane, Far Clip Plane, Field of Viewæ¥è®¡ç®—å‡ºå±å¹•ä¸Šæ¯ä¸€ä¸ªç‚¹çš„ä¸–ç•Œåæ ‡, ä½†æ˜¯ä¼ ç»Ÿçš„åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­è®¡ç®—ä¸–ç•Œåæ ‡çš„æ–¹å¼æ˜¯å¤„ç†åä¾æ¬¡ä¹˜ä»¥ä¸–ç•Œ-è§†å›¾çŸ©é˜µçš„é€†, æ•ˆç‡å ªå¿§. å°±ç®—åˆ©ç”¨ç‚¹å…ƒç€è‰²å™¨é¢„å…ˆè®¡ç®—è§†æ¤ä½“å°„çº¿, æ•ˆç‡æœ‰äº†äº›è®¸æå‡, ä¹Ÿè¿œè¿œè¾¾ä¸åˆ°&quot;ä¼˜é›…&quot;çš„æ°´å‡†.
(PS: æˆ‘ä¼šåœ¨åé¢çš„æ–‡ç« ä¸­è¯¦ç»†ä»‹ç»Global FogåæœŸå¤„ç†ç‰¹æ•ˆ, å…¶ä¸­ä¼šå¯¹åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­é€šè¿‡DepthBufferè®¡ç®—ä¸–ç•Œåæ ‡çš„æ–¹æ³•å±•å¼€è®¨è®º. )</p>
<p>è¯´äº†è¿™ä¹ˆå¤š, æˆ‘ä»¬å‘ç°ç›´æ¥æ±‚ä¸–ç•Œåæ ‡è¿™ç§å¥—è·¯æœ€ç›´æ¥, æœ€å¥½ç†è§£, ä½†ä¼¼ä¹å¹¶ä¸å¤ªå¯å–. é‚£ä¹ˆæˆ‘ä»¬å°±è¦æ€è€ƒä¸€ä¸ªé—®é¢˜: æˆ‘ä»¬çœŸçš„å¿…é¡»å¾—çŸ¥é“å…·ä½“çš„ä¸–ç•Œåæ ‡å˜›?</p>
<p>é€šè¿‡è§‚å¯Ÿä¸Šé¢çš„é‚£å¼ å›¾, æˆ‘ä»¬å‘ç°ä¸ºäº†ç¡®å®šå¦‚ä½•æ¸²æŸ“å¹¶æ··åˆé¢œè‰², æˆ‘ä»¬åªéœ€è¦çŸ¥é“ç›¸å¯¹äºæ‘„åƒæœºæ¥è®², æ­£æ–¹ä½“çš„ç‰‡å…ƒå’ŒåŸæœ¬åœºæ™¯ä¸­å¯¹åº”ä½ç½®çš„åƒç´ è°ç¦»å¾—æ›´è¿œå°±è¡Œäº†. <strong>ä¹Ÿå°±æ˜¯è¯´, æˆ‘ä»¬åªéœ€è¦çŸ¥é“ä¸¤ä¸ªä¸‰ç»´å‘é‡çš„é•¿åº¦, ä¹Ÿå°±æ˜¯ä¸¤ä¸ªå®æ•°, è€Œå¹¶ä¸éœ€è¦çŸ¥é“è¿™ä¸¤ä¸ªä¸‰ç»´å‘é‡çš„xyzéƒ½åˆ†åˆ«æ˜¯ä»€ä¹ˆ</strong>.</p>
<p>æ‰€ä»¥è¯´, æ±‚ä¸–ç•Œåæ ‡çš„è¯æœ‰ç‚¹å„¿æ€é¸¡ç”¨ç‰›åˆ€äº†.</p>
<h2>å¦‚ä½•è·å–ä¸€ä¸ªç‰‡å…ƒæ‰€åœ¨å±å¹•åæ ‡çš„DepthBuffer</h2>
<p><img src="/image/essay3/4.png" alt=""></p>
<p>æˆ‘ä»¬æ˜¯å¦‚ä½•çŸ¥é“ä¸€ä¸ªç‰‡å…ƒçš„æŠ•å½±åæ ‡çš„å‘¢?</p>
<p><figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line">o.pos = mul ( UNITY_MATRIX_MVP, v.vertex );</div></pre></td></tr></table></figure></p>
<p>é‚£ä¹ˆæˆ‘ä»¬è¦æ€ä¹ˆé€šè¿‡ä¸–ç•Œåæ ‡æ¥å°†å…¶xyåˆ†é‡æ˜ å°„åˆ°[0, 1]åŒºé—´å‘¢? æ¯•ç«Ÿåªæœ‰è¿™æ ·æˆ‘ä»¬æ‰èƒ½é‡‡æ ·DepthBufferå•Š! åœ¨UnityCG.cgincä¸­, æœ‰è¿™ä¹ˆä¸ªå‡½æ•°:</p>
<p><figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">inline</span> float4 <span class="title">ComputeNonStereoScreenPos</span><span class="params">(float4 pos)</span> </span></div><div class="line">&#123; </div><div class="line">	float4 o = pos * <span class="number">0.5f</span>; </div><div class="line">	<span class="meta">#<span class="meta-keyword">if</span> defined(UNITY_HALF_TEXEL_OFFSET) </span></div><div class="line">	o.xy = float2(o.x, o.y*_ProjectionParams.x) + o.w * _ScreenParams.zw; </div><div class="line">	<span class="meta">#<span class="meta-keyword">else</span> </span></div><div class="line">	o.xy = float2(o.x, o.y*_ProjectionParams.x) + o.w; </div><div class="line">	<span class="meta">#<span class="meta-keyword">endif</span> o.zw = pos.zw; </span></div><div class="line">	<span class="keyword">return</span> o; </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å¤šæ•°æƒ…å†µä¸‹ä¸Šè¿°ä»£ç ä¹Ÿå¯ä»¥ç›´æ¥å†™æˆä»¥ä¸‹å½¢å¼:</p>
<p><figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">inline</span> float4 <span class="title">ComputeScreenPos</span> <span class="params">(float4 pos)</span> </span></div><div class="line">&#123; </div><div class="line">	float4 o = pos * <span class="number">0.5</span>; </div><div class="line">	o.xy = float2(o.x, o.y*_ProjectionParams.x) + o.w; </div><div class="line">	o.zw = pos.zw; </div><div class="line">	<span class="keyword">return</span> o; </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>çœ‹èµ·æ¥æœ‰ç‚¹å¤æ‚ ... å…ˆä¹˜ä¸ª0.5ç„¶åå†åŠ ä¸Šwåˆ†é‡çš„äºŒåˆ†ä¹‹ä¸€ ... ?</p>
<h2>&quot;ä¹˜ä»¥0.5ç„¶ååŠ ä¸Šwåˆ†é‡çš„äºŒåˆ†ä¹‹ä¸€&quot;åˆ°åº•æ˜¯ä»€ä¹ˆ</h2>
<p>é¦–å…ˆä¸Šä¸ªå›¾</p>
<p><img src="/image/essay3/5.png" alt=""></p>
<p>åœ¨Unityä¸­, mul ( UNITY_MATRIX_MVP, v.vertex )å’ŒUnityObjectToClipPos(float4 ( v.vertex.xyz, 1.0 ) )å¹²çš„å·®ä¸å¤šéƒ½æ˜¯ä¸€å›äº‹å„¿, å°±æ˜¯å°†æ¨¡å‹åæ ‡è½¬æ¢åˆ°æ‘„åƒæœºçš„Homogeneous Clip Space. è¯¦æƒ…å‚è§<a href="https://docs.unity3d.com/Manual/SL-BuiltinFunctions.html" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a>(å…¶å®æˆ‘ä¸ªäººæ›´åŠ æ¨èç”¨UnityObjectToClipPosæ¥ä»£æ›¿ä¼ ç»Ÿçš„ä¹˜ä»¥MVPçŸ©é˜µ. å°¤å…¶æ˜¯æ¶‰åŠåˆ°ç”¨GPU Generate Objectçš„æ—¶å€™, ç›´æ¥ä¹˜ä»¥MVPçŸ©é˜µå¾€å¾€å¾—åˆ°çš„æ˜¯é”™è¯¯çš„ç»“æœ).</p>
<p>ä½†æ˜¯, ä¸€èˆ¬æ¸²æŸ“ç®¡çº¿ä¸ä¼šç«‹åˆ»å°†Clipåçš„åæ ‡æ ‡å‡†åŒ–(ä¹Ÿå°±æ˜¯é™¤ä»¥wåˆ†é‡), è€Œæ˜¯åœ¨ç‚¹å…ƒç€è‰²å‡½æ•°ç»“æŸä»¥åå°†å…¶æ ‡å‡†åŒ–. è¿™ä¸ªåœ°æ–¹æœ‰ç‚¹å‘.</p>
<blockquote>
<p>Once all the vertices are transformed to clip space a final operation called perspective division is performed where we divide the x, y and z components of the position vectors by the vector's homogeneous w component; perspective division is what transforms the 4D clip space coordinates to 3D normalized device coordinates. <strong>This step is performed automatically at the end of each vertex shader run</strong>.</p>
</blockquote>
<p>æ‰€ä»¥, å¯ä»¥è®¤ä¸ºæˆ‘ä»¬ç°åœ¨å¾—åˆ°çš„æ˜¯å·²ç»ç»è¿‡Clipping, ä½†æ˜¯è¿˜æ²¡æœ‰æ ‡å‡†åŒ–çš„æŠ•å½±åæ ‡. æˆ‘ä»¬çš„ç›®çš„æ˜¯è¦å°†è¿™ä¸ªåæ ‡è½¬åŒ–ä¸ºxyåœ¨[0, 1]ä¹‹é—´, è€Œzåæ˜ æ·±åº¦çš„å±å¹•åæ ‡.</p>
<p>æ—¢ç„¶æ˜¯[0, 1]ä¹‹é—´, é‚£ä¹ˆæˆ‘ä»¬è‡ªç„¶å°±ä¸ç”¨å‘ä¸Šå›¾ä¸€æ ·ä¹˜ä»¥ViewPortå®½é«˜äº†. åŒæ—¶è¦æ³¨æ„ViewPortåæ ‡åŸç‚¹çš„é—®é¢˜: Unityä¸­æ˜¯å·¦ä¸‹è§’, è€Œä¸Šå›¾é‡‡ç”¨çš„æ˜¯å·¦ä¸Šè§’. æ‰€ä»¥å…·ä½“åˆ°æˆ‘ä»¬çš„æƒ…å†µä¸‹yå’Œxçš„å¤„ç†æ–¹å¼åº”è¯¥æ˜¯ç›¸åŒçš„.</p>
<p>ä¸ºäº†å°†[-1, 1]æ˜ å°„åˆ°[0, 1]ä¸Š, å°†åŸåæ ‡åŠ 1ç„¶åé™¤2æ˜¯æ˜¾è€Œæ˜“è§çš„. ä½†æ˜¯è¦æ³¨æ„æˆ‘ä»¬çš„xå’Œyéƒ½æ¯”äººå®¶å¤šä¹˜ç€ä¸€ä¸ªwåˆ†é‡. å› ä¸ºè¿ç®—åˆ°è¿™ä¸ªæ—¶å€™æˆ‘ä»¬ä¾ç„¶åœ¨ç‚¹å…ƒç€è‰²å™¨å‡½æ•°ä¸­, <strong>å› æ­¤æœ€ç»ˆçš„æ ‡å‡†åŒ–è¿‡ç¨‹è¿˜æ²¡æœ‰æ‰§è¡Œ</strong>.</p>
<p>æ‰€ä»¥, æˆ‘ä»¬å°±å¾—åˆ°äº†ä¸‹é¢è¿™æ®µä»£ç (å…¶å®ä¹Ÿæ˜¯ä¸Šé¢é‚£æ®µ)</p>
<p><figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line">float4 o = pos * <span class="number">0.5</span>;</div><div class="line">o.xy = float2(o.x, o.y*_ProjectionParams.x) + o.w;</div></pre></td></tr></table></figure></p>
<h2>ç‚¹å…ƒç€è‰²å™¨</h2>
<p><figure class="highlight cpp"><table><tr><td class="code"><pre><div class="line"><span class="function">v2f <span class="title">vert</span> <span class="params">( appdata_base v )</span> </span></div><div class="line">&#123; </div><div class="line">	v2f o; </div><div class="line">	o.pos = UnityObjectToClipPos ( v.vertex ); </div><div class="line">	o.projPos = ComputeScreenPos ( o.pos ); </div><div class="line">	<span class="keyword">return</span> o; </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2>éå¸¸ç®€å•çš„ç‰‡å…ƒç€è‰²å™¨å‡½æ•°</h2>
<p>åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­, æˆ‘ä»¬åªéœ€è¦æå–å‡ºå¯¹åº”å±å¹•ä½ç½®çš„æ·±åº¦ä¿¡æ¯, ç„¶åå’Œç‚¹å…ƒç€è‰²å™¨çš„è¾“å‡ºæ·±åº¦ä¿¡æ¯ä½œæ¯”è¾ƒ, æ ¹æ®ç›¸å·®ç»“æœè¿›è¡Œæ’å€¼å³å¯.</p>
<p><figure class="highlight"><table><tr><td class="code"><pre><div class="line">fixed4 frag ( v2f i ) : SV_TARGET </div><div class="line">&#123; </div><div class="line">	float4 finalColor = _MainColor; </div><div class="line">	float sceneZ = LinearEyeDepth (tex2Dproj(_CameraDepthTexture, UNITY_PROJ_COORD(i.projPos))); </div><div class="line">	float partZ = i.projPos.z; </div><div class="line">	float diff = min ( (abs(sceneZ - partZ)) / _Threshold, 1); </div><div class="line">	finalColor = lerp(_HighlightColor, _MainColor, diff); </div><div class="line">	return finalColor; </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2>æœ€ç»ˆæ•ˆæœ</h2>
<p><img src="/image/essay3/6.png" alt=""></p>
<h2>åè®°</h2>
<p>å…¶å®è¿™ä¸ªç‰¹æ•ˆçš„åŸç†çœŸå¿ƒä¸€ç‚¹ä¹Ÿä¸å¤æ‚, åªæ˜¯ç”¨åˆ°äº†DepthTextureæ¥è·å–å±å¹•ä¸­æ¯ä¸ªåƒç´ çš„æ·±åº¦ä¿¡æ¯æ¥è¿›è¡Œæ¯”å¯¹ä»¥å†³å®šæ¨¡å‹æœ€ç»ˆçš„é¢œè‰². ä½†æ˜¯UnityCG.cgincé‡Œé¢çš„ComputeScreenPoså‡½æ•°é‚£ä¸ªå¥‡æ€ªçš„å¤–è§‚å¼•å‘äº†æˆ‘æå¤§çš„å¥½å¥‡å¿ƒ.</p>

                <hr>
                
                <!-- å¤šè¯´ Share start -->
                <div class="ds-share"
                     style="text-align: right"
                     data-thread-key="2016/11/27/essay3/"
                     data-title="ç›¸äº¤é«˜äº®(æ‰«ææ•ˆæœ)"
                     data-url="http://www.weymire.com/2016/11/27/essay3/"
                     data-images="http://www.weymire.com/2016/11/27/essay3/essay3.jpg"
                     data-content=" æœ¬æ–‡åŒæ—¶ä¹Ÿå‘è¡¨åœ¨æˆ‘çš„çŸ¥ä¹ä¸“æ ä¸ŠğŸ˜„. ä¸è¿‡å½“æ—¶å†™ä½œçš„é£æ ¼å®åœ¨ä¸é€‚åˆæŠ€æœ¯æ–‡, å› æ­¤åœ¨ä¸ªäººåšå®¢ä¸­... | Weymire&#39;s Blog ">
                    <div class="ds-share-inline">
                        <ul class="ds-share-icons-16">
                            <li data-toggle="ds-share-icons-more"><a class="ds-more" href="#">åˆ†äº«åˆ°ï¼š</a></li>
                            <li><a class="ds-wechat flat" href="javascript:void(0);" data-service="wechat">å¾®ä¿¡</a></li>
                            <li><a class="ds-weibo flat" href="javascript:void(0);" data-service="weibo">å¾®åš</a></li>
                            <li><a class="ds-douban flat" href="javascript:void(0);" data-service="douban">è±†ç“£</a></li>
                        </ul>
                        <div class="ds-share-icons-more">
                        </div>
                    </div>
                    <hr>
                </div>
                <!-- å¤šè¯´ Share end-->
                

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2016/12/04/essay2/" data-toggle="tooltip" data-placement="top"
                           title="Vertical FogåŠåœ¨Fragment Shaderä¸­é‡å»ºä¸–ç•Œåæ ‡">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2016/11/26/essay4/" data-toggle="tooltip" data-placement="top"
                           title="é•œå¤´ç‚«å…‰ä¸å…‰æ™•">Next Post &rarr;</a>
                    </li>
                    
                </ul>
<section class="youyan" id="comments">
    <div id="uyan_frame"></div>
    <script src="https://v2.uyan.cc/code/uyan.js?uid=2128030"></script>
</section>

                
                <!-- å¤šè¯´è¯„è®ºæ¡† start -->
                <div class="comment">
                    <div class="ds-thread"
                         data-thread-key="2016/11/27/essay3/"
                         data-title="ç›¸äº¤é«˜äº®(æ‰«ææ•ˆæœ)"
                         data-url="http://www.weymire.com/2016/11/27/essay3/">
                    </div>
                </div>
                <!-- å¤šè¯´è¯„è®ºæ¡† end -->
                

                

            </div>

            <div class="hidden-xs col-sm-3 toc-col">
                <div class="toc-wrap">
                    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-text">ç›¸äº¤é«˜äº®(Intersection Highlight)æ˜¯ä»€ä¹ˆ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-text">ç›¸äº¤é«˜äº®ç€è‰²å™¨å·¥ä½œåŸç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-text">çŒœä¸€çŒœå®ç°çš„æ–¹æ³•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-text">å¦‚ä½•ä¼˜é›…åœ°æ±‚åæ ‡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-text">å¦‚ä½•è·å–ä¸€ä¸ªç‰‡å…ƒæ‰€åœ¨å±å¹•åæ ‡çš„DepthBuffer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-text">"ä¹˜ä»¥0.5ç„¶ååŠ ä¸Šwåˆ†é‡çš„äºŒåˆ†ä¹‹ä¸€"åˆ°åº•æ˜¯ä»€ä¹ˆ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-text">ç‚¹å…ƒç€è‰²å™¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-text">éå¸¸ç®€å•çš„ç‰‡å…ƒç€è‰²å™¨å‡½æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-text">æœ€ç»ˆæ•ˆæœ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-text">åè®°</span></a></li></ol>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5 class="text-center">
                        <a href="/tags/">FEATURED TAGS</a>
                    </h5>
                    <div class="tags">
                        
                        <a class="tag" href="/tags/#Unity"
                           title="Unity">Unity</a>
                        
                        <a class="tag" href="/tags/#Computer Graphics"
                           title="Computer Graphics">Computer Graphics</a>
                        
                        <a class="tag" href="/tags/#Shader"
                           title="Shader">Shader</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
            </div>
        </div>

    </div>
</article>


<!-- å¤šè¯´å…¬å…±JSä»£ç  start (ä¸€ä¸ªç½‘é¡µåªéœ€æ’å…¥ä¸€æ¬¡) -->
<script type="text/javascript">
    // dynamic User by Hux
    var _user = 'yujingping';

    // duoshuo comment query.
    var duoshuoQuery = {short_name: _user};
    (function () {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';
        ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
</script>
<!-- å¤šè¯´å…¬å…±JSä»£ç  end -->





<!-- Footer -->
<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center">
                <br>
                <ul class="list-inline text-center">
                
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                
                
                    <li>
                        <a target="_blank" href="https://twitter.com/yujingping">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                
                
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/yu-jing-ping-64">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">çŸ¥</i>
                            </span>
                        </a>
                    </li>
                

                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/AlphaMistral">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Weymire 2017
                    <br>
                    <span id="busuanzi_container_site_pv" style="font-size: 12px;">PV: <span id="busuanzi_value_site_pv"></span> Times</span>
                </p>

            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/blog.js"></script>

<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("http://www.weymire.com/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>

<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-91741512-1';
    var _gaDomain = 'auto';
    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>


<!-- Baidu Tongji -->

<script>
    var _baId = 'a7bea2767d4659bf7b7a4f62100a2a13';
    // Originial
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?" + _baId;
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


<!-- swiftype -->
<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','null','2.0.0');
</script>

<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<!--wechat title img-->
<img class="wechat-title-img" src="image/avatar.jpg"><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>

</html>
